# Made by: Airil / Ainhoa

import time
import random

import os
import re
import requests
import sys

import subprocess
from subprocess import call

from termcolor import colored
from pwn import *

from reconocimiento import *
from other_functions import *
from automatic import *
from attacks import *

print(colored("\n                                                           __====-_        _-====__", 'red', attrs=['blink']),
      colored("\n                                                       _--^^^#####//      \\#####^^^--_", 'red', attrs=['blink']),
      colored("\n                                                    _-^##########// (    ) \\##########^-_", 'red', attrs=['blink']),
      colored("\n                                                   -############//  |\^^/|  \\############-", 'red', attrs=['blink']),
      colored("\n                                                 _/############//   (@::@)   \\############\_", 'red', attrs=['blink']),
      colored("\n                                                ./#############((   \.\/./   ))#############\.", 'red', attrs=['blink']),
      colored("\n                                                -###############\\    (oo)    //###############-", 'red', attrs=['blink']),
      colored("\n                                                -#################\\  /  \  //#################-", 'red', attrs=['blink']),
      colored("\n                                              _#/|##########/\######(    )######/\##########|\#_", 'red', attrs=['blink']),
      colored("\n\n#########   #     #   #     #   #      #   #####    ######   ######         #####    ######     ####     ####     ####    #       #", 'red', attrs=['blink']),
      colored("\n    #       #     #   #     #   # #    #   #    #   #        #     #        #    #   #     #   #    #   #        #    #   # #     #", 'red', attrs=['blink']),
      colored("\n    #       #######   #     #   #   #  #   #    #   ###      ######         #    #   ######    ######   #   ###  #    #   #   #   #", 'red', attrs=['blink']),
      colored("\n    #       #     #   #     #   #    # #   #    #   #        #     #        #    #   #     #   #    #   #    #   #    #   #     # #", 'red', attrs=['blink']),
      colored("\n    #       #     #    #####    #      #   #####    ######   #     #        #####    #     #   #    #    ####     ####    #       #", 'red', attrs=['blink']))

print(colored("\n\n####   ThunderDragon   ####", 'red'))
print(colored("Made by: Airil\n", 'cyan'))
print(colored("I am not responsible for the misuse that may be given to this tool!\n\n", 'red', attrs=['reverse', 'blink', 'dark', 'dark']))

DN = open(os.devnull, 'w')

realMac = ""
net_interface = ""

try:
    if os.getuid() == 0:
        ###### CHECKS
        print("\n" + colored("[+]", 'green'), "Checking requeriments... ")
        if str(subprocess.check_output(["which", "searchsploit"])) != "":
            print(colored("[+]", 'green'), "Searchsploit installed")
            print(colored("[-] If you haven't updated Searchsploit recently, please run 'searchsploit -u' to update it.", 'yellow'))
        else:
            print(colored("[-] Instaling searchsploit...", 'yellow'))
            call(["sudo", "apt", "update", "&&", "sudo", "apt", "-y", "install", "exploitdb", "-Y"])
            print(colored("[+]", 'green'), "Searchsploit installed")
            
        if str(subprocess.check_output(["which", "whatweb"])) != "":
            print(colored("[+]", 'green'), "Whatweb installed")
        else:
            print(colored("[-] Instaling whatweb...", 'yellow'))
            call(["sudo", "apt-get", "install", "whatweb", "-Y"])
            print(colored("[+]", 'green'), "Whatweb installed")
            
        if str(subprocess.check_output(["which", "xclip"])) != "":
            print(colored("[+]", 'green'), "xclip installed")
        else:
            print(colored("[-] Instaling xclip...", 'yellow'))
            call(["sudo", "apt-get", "install", "xclip", "-Y"])
            print(colored("[+]", 'green'), "xclip installed")
        
        if str(subprocess.check_output(["which", "xsel"])) != "":
            print(colored("[+]", 'green'), "xsel installed")
        else:
            print(colored("[-] Instaling xsel...", 'yellow'))
            call(["sudo", "apt-get", "install", "xsel", "-Y"])
            print(colored("[+]", 'green'), "xsel installed")
            
        ###### EJECUCION
        while True:
            option = input(str(colored("\nThunderDragon", 'blue') + colored(" option > ", 'red'))).lower().strip()
            
            if option == "subdomains":
                domain = input(str(colored("\nThunderDragon", 'blue') + colored(" DOMAIN > ", 'red'))).strip()
                sslcert = input(str(colored("\nThunderDragon", 'blue') + colored(" Is https? [y/n] > ", 'red'))).strip()
                brute = input(str(colored("\nThunderDragon", 'blue') + colored(" Do you want to use Brute Force to try to find more? [y/n] > ", 'red'))).lower().strip()
                subdomainslist = subdomains(domain, brute, sslcert)
                
                if subdomainslist == []:
                    print(colored("\n[!] Subdomains not found!", 'red'))
                else:
                    print(colored("\n[+] Subdomains founded!\n", 'green'))
                    
                    print(colored("SUBDOMAINS\n", 'green', attrs=['dark', 'underline']))
                    for i in subdomainslist:
                        print(colored(i, 'blue'))
                        
            elif option == "fuzzing":
                url = input(str(colored("\nThunderDragon", 'blue') + colored(" URL > ", 'red'))).strip()
                if "http://" not in url and "https://" not in url:
                    ssl = input(str(colored("\nThunderDragon", 'blue') + colored(" http or https? > ", 'red'))).strip()
                    url = ssl + "://" + url
                hidden_codes = input(str(colored("\nThunderDragon", 'blue') + colored(" HIDDEN RESPONSE CODES [example: 403 402 500] > ", 'red'))).strip()
                if hidden_codes != "":
                    hc = list(map(int, hidden_codes.split()))
                else:
                    hc = []
                
                directories = dir_fuzzing(url, hc)
                
                print(colored("\nDIRECTORIES:", 'green', attrs=['underline', 'dark']))
                for dir in directories:
                    print(colored(dir, 'cyan'))
            
            elif option == "port_scan":
                ip = input(str(colored("\nThunderDragon", 'blue') + colored(" IP > ", 'red'))).lower().strip()
                ports = input(str(colored("\nThunderDragon", 'blue') + colored(" Port range (example: 1 655536) (enter with nothing for scan most common ports or all for scan all ports) > ", 'red'))).lower().strip()
                protocolo = input(str(colored("\nThunderDragon", 'blue') + colored(" Protocol [TCP/UDP] > ", 'red'))).lower().strip()
                valid_ports = port_scan(ip, ports, protocolo)
                
                print(colored("\nPORTS:", 'green', attrs=['underline', 'dark']))
                for port, service in valid_ports.items():
                    if service:
                        print(colored(str(port), 'cyan') + " " + service)
                    else:
                        print(colored(str(port), 'cyan'))
            
            elif option == "scan_localnet":
                active_hosts = scan_local_network(input(str(colored("\nThunderDragon", 'blue') + colored(" ip and cidr (example: 255.255.127.0/24) > ", 'red'))).strip())
                
                print(colored("\nActive Hosts\n", 'green', attrs=['dark', 'underline']))
                for host in active_hosts:
                    print(colored(host, 'blue'))
            
            elif option == "show_metadata":
                show_metadata(input(str(colored("\nThunderDragon", 'blue') + colored(" File Path > ", 'red'))).strip())
                
            elif option == "change_mac":
                call("ifconfig", shell=True)
                print("\n")
                net_interface = input(str(colored("\nThunderDragon", 'blue') + colored(" net interface > ", 'red'))).lower().strip()
                
                if realMac == "":
                    ifconfig_result = subprocess.check_output(["ifconfig", net_interface])
                    macSearch = re.search(r"\w\w:\w\w:\w\w:\w\w:\w\w:\w\w", str(ifconfig_result))
                    if macSearch:
                        realMac = macSearch.group(0)
                        print(colored("\n[+]", 'green'), "Real MAC:", colored(str(realMac), 'cyan'))

                change_mac(net_interface)
            
            elif option == "whois":
                domain = input(str(colored("\nThunderDragon", 'blue') + colored(" DOMAIN > ", 'red'))).lower().strip()
                get_whois_info(domain)
                
            elif option == "tec_enum":
                domain = input(str(colored("\nThunderDragon", 'blue') + colored(" DOMAIN > ", 'red'))).lower().strip()
                tec_enum(domain)
            
            elif option == "encoder":
                encoder()
                
            elif option == "decoder":
                decoder()
                
            elif option == "auto_recognition":
                host, ports, protocol, brute, sslcert, url, hc = "", "", "", "", "", "", []
                whois_ = input(str(colored("\nThunderDragon", 'blue') + colored(" WANT TO VIEW INFORMATION ABOUT THE TARGET [y/n] > ", 'red'))).lower().strip()
                domain = input(str(colored("\nThunderDragon", 'blue') + colored(" DOMAIN > ", 'red'))).lower().strip()
                tec_enumeration = input(str(colored("\nThunderDragon", 'blue') + colored(" WANT TO ENUMERATE WEB TECNOLOGIES [y/n] > ", 'red'))).lower().strip()
                port_enum = input(str(colored("\nThunderDragon", 'blue') + colored(" WANT TO ENUMERATE PORTS [y/n] > ", 'red'))).lower().strip()
                host = ""
                if port_enum == "y":
                    host = input(str(colored("\nThunderDragon", 'blue') + colored(" TARGET IP > ", 'red'))).lower().strip()
                    ports = input(str(colored("\nThunderDragon", 'blue') + colored(" Port range (example: 1 655536) (enter with nothing for scan most common ports or all for scan all ports) > ", 'red'))).lower().strip()
                    protocol = input(str(colored("\nThunderDragon", 'blue') + colored(" PROTOCOL [TCP/UDP] > ", 'red'))).lower().strip()
                subdomain = input(str(colored("\nThunderDragon", 'blue') + colored(" WANT TO ENUMERATE SUBDOMAINS [y/n] > ", 'red'))).lower().strip()
                directories = input(str(colored("\nThunderDragon", 'blue') + colored(" WANT TO ENUMERATE DIRECTORIES [y/n] > ", 'red'))).lower().strip()
                if subdomain == "y" or directories == "y":
                    brute = input(str(colored("\nThunderDragon", 'blue') + colored(" WANT TO USE BRUTE FORCE [y/n] > ", 'red'))).lower().strip()
                    sslcert = input(str(colored("\nThunderDragon", 'blue') + colored(" http or https? > ", 'red'))).strip()
                if directories == "y":
                    hidden_codes = input(str(colored("\nThunderDragon", 'blue') + colored(" HIDDEN RESPONSE CODES [example: 403 402 500] > ", 'red'))).strip()
                    if hidden_codes != "":
                        hc = list(map(int, hidden_codes.split()))
                    else:
                        hc = []
                    url = input(str(colored("\nThunderDragon", 'blue') + colored(" URL > ", 'red'))).strip()
                    if "http://" not in url and "https://" not in url:
                        url = sslcert + "://" + url
                
                auto_recognition(whois_, domain, tec_enumeration, port_enum, host, ports, protocol, subdomain, brute, sslcert, directories, url, hc)
            
            elif option == "xss_scripts":
                xss_scripts()
            
            elif option == "help":
                print(colored("\nENUMERATION:", 'green', attrs=['underline', 'dark'])+
                      "\n· whois"+
                      "\n· port_scan"+
                      "\n· scan_localnet"+
                      "\n· subdomains"+
                      "\n· fuzzing"+
                      "\n· tec_enum"+
                      "\n· show_metadata"+
                      colored("\n\nATTACK:", 'green', attrs=['dark', 'underline'])+
                      "\n· xss_scripts"+
                      colored("\n\nAUTOMATIC:", 'green', attrs=['dark', 'underline'])+
                      "\n· auto_recognition"+
                      colored("\n\nOTHER FUNCTIONS:", 'green', attrs=['dark', 'underline'])+
                      "\n· encoder"+
                      "\n· decoder"+
                      "\n· change_mac"+
                      "\n· exit")
            
            elif option == "exit":
                if realMac != "":
                    print(colored("\n[+] Setting real MAC..."))
                    call(["ifconfig", net_interface, "down"], stdout=DN, stderr=DN)
                    call(["ifconfig", net_interface, "hw", "ether", realMac])
                    call(["ifconfig", net_interface, "up"], stdout=DN, stderr=DN)
                
                exit()
                
            elif option == "clear":
                clear()
                              
    else:
        print("\n" + colored("[!] Login as Root ", 'red') + colored("and try again\n", 'yellow'))

except:
    print(colored("[!]", 'red') + colored(" This tool only work on Linux", 'red'))
